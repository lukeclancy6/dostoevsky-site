---
interface Props {
  quote: string;
  source: string;
  annotation: string;
  currentIndex: number;
  total: number;
}

const { quote, source, annotation, currentIndex, total } = Astro.props;
---

<article class="quote-card book-card" id="quote-card" aria-live="polite" aria-label={`Quote ${currentIndex + 1} of ${total}`}>
  <div class="quote-card-inner">
    <!-- Page indicator top -->
    <p class="page-indicator-top label" aria-label={`Page ${currentIndex + 1} of ${total}`}>
      <span aria-hidden="true">pg. {currentIndex + 1} of {total}</span>
    </p>

    <!-- The quote itself -->
    <div class="quote-body">
      <p class="quote-text" id="quote-text">{quote}</p>
      <p class="quote-source" id="quote-source">— {source}</p>
    </div>

    <!-- Ornamental rule -->
    <div class="card-rule" aria-hidden="true">❦</div>

    <!-- The Editor's annotation -->
    <div class="annotation-block">
      <p class="annotation-label label">The Editor's Note</p>
      <p class="quote-annotation" id="quote-annotation">{annotation}</p>
    </div>

    <!-- Prev / Next navigation -->
    <nav class="card-nav" aria-label="Quote navigation">
      <button class="card-nav-btn prev-btn" id="prev-btn" aria-label="Previous quote">
        ◂ <span>Previous</span>
      </button>
      <span class="page-indicator" aria-hidden="true">{currentIndex + 1} / {total}</span>
      <button class="card-nav-btn next-btn" id="next-btn" aria-label="Next quote">
        <span>Next</span> ▸
      </button>
    </nav>
  </div>
</article>

<style>
  .quote-card {
    width: 100%;
    max-width: 660px;
    margin: 0 auto;
    padding: var(--spacing-xl) var(--spacing-xl) var(--spacing-lg);
    border-radius: 2px;
    transition: opacity 200ms ease, filter 200ms ease;
  }

  .quote-card.transitioning {
    opacity: 0;
    filter: blur(2px);
  }

  .quote-card-inner {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
  }

  .page-indicator-top {
    text-align: right;
    font-size: var(--font-size-xs);
    color: var(--color-ink-secondary);
    letter-spacing: 0.1em;
    margin: 0;
  }

  .quote-body {
    min-height: 12em;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
  }

  .quote-text {
    font-family: var(--font-body);
    font-size: 1.2rem;
    font-style: italic;
    line-height: 1.9;
    color: var(--color-ink-primary);
  }

  .quote-source {
    font-family: var(--font-label);
    font-size: var(--font-size-sm);
    color: var(--color-ink-secondary);
    letter-spacing: 0.06em;
  }

  .card-rule {
    text-align: center;
    font-size: 1.2rem;
    color: var(--color-accent-tan);
    border-top: 1px solid var(--color-paper-dark);
    padding-top: var(--spacing-md);
  }

  .annotation-block {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
  }

  .annotation-label {
    font-size: var(--font-size-xs);
    color: var(--color-accent-tan);
    letter-spacing: 0.12em;
  }

  .quote-annotation {
    font-family: var(--font-body);
    font-size: 0.9rem;
    color: var(--color-ink-secondary);
    line-height: 1.75;
    font-style: normal;
  }

  /* Navigation */
  .card-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: var(--spacing-sm);
    padding-top: var(--spacing-md);
    border-top: 1px solid var(--color-paper-dark);
  }

  .card-nav-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-family: var(--font-label);
    font-size: var(--font-size-sm);
    color: var(--color-ink-secondary);
    letter-spacing: 0.06em;
    padding: var(--spacing-xs) var(--spacing-sm);
    transition: color var(--transition-base);
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
  }

  .card-nav-btn:hover {
    color: var(--color-accent-red);
  }

  .card-nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .page-indicator {
    font-family: var(--font-label);
    font-size: var(--font-size-xs);
    color: var(--color-accent-tan);
    letter-spacing: 0.1em;
  }
</style>
